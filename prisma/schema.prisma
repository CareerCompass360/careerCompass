// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
}

model User {
  id            String   @id @default(cuid())
  stackAuthId   String   @unique
  username      String   @unique
  firstName     String?
  lastName      String?
  email         String   @unique
  profilePicture String?
  bio           String?
  dateOfBirth   DateTime?
  phone         String?
  address       String?
  isAdmin       Boolean  @default(false)
  isCounselor   Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([username])
  @@index([stackAuthId])
  @@index([email])
}

model CounselorApplication {
  id                        String   @id @default(cuid())
  
  // User Link
  stackAuthId               String?  // Link to User model
  
  // Basic Identity
  fullName                  String
  profilePhoto              String?
  email                     String   @unique
  mobileNumber              String
  dateOfBirth               DateTime
  gender                    String?
  city                      String
  country                   String
  languagesSpoken           String[]
  linkedinProfile           String
  personalWebsite           String?
  
  // Professional Background
  currentJobTitle           String
  currentOrganization       String
  totalYearsExperience      Int
  primaryCareerDomain       String
  subSpecialization         String
  highestEducationLevel     String
  degreeName                String
  university                String
  yearOfGraduation          Int
  
  // Career Counseling Expertise
  studentTypes              String[]
  careerAreasCanCounsel     String[]
  topicsCanHelp             String[]
  
  // Real Experience Proof
  hasFormedMentored         Boolean
  numberOfPeopleGuided      Int?
  whereMentored             String?
  successStory              String?
  
  // Documents for Verification
  resumeUrl                 String
  degreeCertificateUrl      String
  workExperienceProofUrl    String
  counselingCertUrl         String?
  
  // Platform Readiness
  willingOnlineCounseling   Boolean
  preferredMode             String[]
  availableHoursPerWeek     Int
  preferredTimeSlots        String[]
  timeZone                  String
  
  // Commercials
  wantToCharge              Boolean
  pricePer30Min             Float?
  pricePer60Min             Float?
  openToRevenueSharing      Boolean
  
  // Trust & Ethics
  whyJoinPlatform           String
  whatMakesQualified        String
  agreedToTerms             Boolean
  digitalSignature          String
  
  // Status
  status                    String   @default("pending") // pending, approved, rejected, removed
  rejectedAt                DateTime?
  removedAt                 DateTime?
  
  // Relations
  profile                   CounselorProfile?
  
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt

  @@index([email])
  @@index([status])
}

model Booking {
  id                String   @id @default(cuid())
  
  // User Information
  userId            String
  userName          String
  userEmail         String
  userPhone         String?
  
  // Counselor Information
  counselorId       String   // CounselorApplication ID
  counselorName     String
  counselorEmail    String
  
  // Session Details
  sessionDate       DateTime
  sessionTime       String   // e.g., "10:00 AM - 10:30 AM"
  duration          Int      // in minutes (30 or 60)
  sessionType       String   // video, audio, chat
  
  // Booking Details
  userMessage       String?  // Optional message from user
  topic             String   // What they want to discuss
  
  // Status
  status            String   @default("pending") // pending, approved, rejected, completed, cancelled
  
  // Counselor Response
  rejectionReason   String?
  
  // Meeting Details (after approval)
  meetingLink       String?
  meetingNotes      String?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([counselorId])
  @@index([userId])
  @@index([status])
}
model CounselorEditRequest {
  id                String   @id @default(cuid())
  
  counselorId       String
  counselorEmail    String
  counselorName     String
  
  requestedFields   String[] // Fields they want to edit
  reason            String   // Why they need to edit
  
  status            String   @default("pending") // pending, approved, rejected
  
  adminResponse     String?  // Admin's response/reason
  respondedBy       String?  // Admin who responded
  respondedAt       DateTime?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([counselorEmail])
  @@index([status])
}

model CounselorProfile {
  id                String   @id @default(cuid())
  
  // Link to CounselorApplication
  applicationId     String   @unique
  application       CounselorApplication @relation(fields: [applicationId], references: [id])
  stackAuthId       String   @unique // Link to User
  
  // Profile Info (from approved application)
  fullName          String
  email             String   @unique
  mobileNumber      String
  profilePhoto      String?
  city              String
  country           String
  
  // Career Info
  jobTitle          String
  organization      String
  yearsExperience   Int
  specialization    String
  
  // Counseling Details
  availableHours    Int      // Hours per week
  pricePerHour      Float    // Hourly rate
  pricePer30Min     Float?
  pricePer60Min     Float?
  timeZone          String
  languagesSpoken   String[]
  
  // Stats
  totalBookings     Int      @default(0)
  completedSessions Int      @default(0)
  totalEarnings     Float    @default(0)
  averageRating     Float?
  
  // Last month stats
  lastMonthBookings Int      @default(0)
  lastMonthEarnings Float    @default(0)
  
  // Status
  isActive          Boolean  @default(true)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([stackAuthId])
  @@index([email])
  @@index([isActive])
}

model EmailOTP {
  id            String   @id @default(cuid())
  email         String
  otp           String
  createdAt     DateTime @default(now())
  expiresAt     DateTime
  attemptCount  Int      @default(1)
  lastSentAt    DateTime @default(now())

  @@index([email])
  @@index([expiresAt])
}